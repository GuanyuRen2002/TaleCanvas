# TaleCanvas - 智能绘本生成器

一个基于AI的智能儿童绘本生成系统，能够自动创作包含故事文本和插图的完整绘本。

## ✨ 功能特点

- 🎨 **智能故事生成**: 使用GPT-4生成连贯的10页儿童故事
- 🖼️ **AI插图创作**: 调用DALL-E API生成精美的插图
- 🎭 **角色一致性**: 确保角色外观在所有页面中保持一致
- 🌍 **场景连贯性**: 场景设置与故事情节完美匹配
- 📱 **现代UI设计**: 美观的界面，左侧聊天，右侧绘本展示
- 📄 **PDF导出**: 支持导出完整绘本为PDF文件
- 🎵 **语音合成**: 集成Azure语音服务

## 🛠️ 技术栈

### 后端
- **Flask**: Web框架
- **Gemini API**: 文本生成 + 图像生成
- **ReportLab**: PDF生成
- **Azure Cognitive Services**: 语音合成

### 前端
- **HTML5/CSS3**: 现代响应式界面
- **JavaScript**: 交互逻辑和动画效果
- **Fetch API**: 异步通信

## 📦 安装说明

### 1. 克隆项目
```bash
git clone <repository-url>
cd TaleCanvas
```

### 2. 安装依赖
```bash
pip install -r requirements.txt
```

### 3. 配置API密钥
在 `config.py` 文件中设置您的API密钥：

```python
class Config:
    OPENAI_API_KEY = "your-openai-api-key-here"
    # 其他配置...
```

或者设置环境变量：
```bash
export OPENAI_API_KEY="your-openai-api-key-here"
```

### 4. 启动应用
```bash
python run.py
```

访问 http://localhost:5000 开始使用！

## 🚀 使用指南

### 创建绘本
1. **填写故事信息**:
   - 故事主题（如：勇气与友谊）
   - 主要角色（如：小松）
   - 故事背景（如：神奇的云端世界）
   - 角色描述（详细的外观特征）
   - 场景描述（环境和氛围）

2. **点击生成**: 系统将自动创作10页完整绘本

3. **浏览绘本**: 使用导航按钮或键盘方向键翻页

4. **导出PDF**: 点击导出按钮下载完整绘本

### 示例输入
```
故事主题: 勇气与友谊
主要角色: 小松
故事背景: 神奇的云端世界
角色描述: 一个6岁的小男孩，有着黑色的短发，穿着蓝色的上衣和棕色的短裤，眼睛圆圆的很可爱
场景描述: 高高的云端之上，有着柔软洁白的云朵，给人宁静祥和的感觉
```

## 🎨 系统架构

```
TaleCanvas/
├── app.py              # Flask主应用
├── config.py           # 配置文件
├── run.py             # 启动脚本
├── local_tts.py       # 语音合成模块
├── requirements.txt   # Python依赖
├── templates/         # HTML模板
│   └── index.html
├── static/           # 静态资源
│   ├── css/
│   │   └── style.css
│   ├── js/
│   │   └── app.js
│   └── images/
├── exports/          # PDF导出目录
└── README.md
```

## 🔧 核心功能

### 故事生成流程
1. **主题分析**: 分析用户输入的故事主题
2. **情节构思**: 生成10页连贯的故事大纲
3. **文本创作**: 为每页生成约50字的儿童友好文本
4. **一致性检查**: 确保前后情节逻辑连贯

### 插图生成流程
1. **提示词生成**: 基于故事文本生成详细的图像描述
2. **角色一致性**: 维护角色外观的统一性
3. **场景匹配**: 确保背景与故事情节匹配
4. **风格统一**: 使用一致的艺术风格

### 一致性保证机制
- **角色描述模板**: 标准化的角色特征描述
- **场景设定库**: 预定义的场景描述模板
- **提示词优化**: 智能的提示词生成算法
- **视觉验证**: 自动检查生成图像的一致性

## 🎯 特色亮点

### 1. 智能故事创作
- 基于GPT-4的高质量文本生成
- 适合儿童的语言风格和认知水平
- 富有教育意义和娱乐性的情节设计

### 2. 精美插图生成
- DALL-E生成的高质量插图
- 专为儿童绘本优化的视觉风格
- 角色和场景的完美一致性

### 3. 用户体验优化
- 直观的聊天式交互界面
- 实时的生成进度反馈
- 流畅的翻页动画效果

### 4. 完整的导出功能
- 高质量PDF格式导出
- 保持原有的视觉效果
- 适合打印和分享

## 📋 API接口

### POST /api/generate_story
生成完整绘本

**请求参数:**
```json
{
  "theme": "故事主题",
  "main_character": "主要角色",
  "setting": "故事背景",
  "character_desc": "角色描述",
  "scene_desc": "场景描述"
}
```

**响应格式:**
```json
{
  "success": true,
  "storybook": {
    "id": "绘本ID",
    "theme": "故事主题",
    "pages": [...],
    "cover": {...}
  }
}
```

### POST /api/export_pdf
导出PDF文件

### GET /api/get_current_storybook
获取当前绘本数据

## 🔍 技术细节

### 故事生成算法
1. **主题分析**: 解析用户输入的主题关键词
2. **结构规划**: 设计10页的故事结构框架
3. **内容生成**: 逐页生成具体的故事内容
4. **连贯性优化**: 确保前后页面的逻辑连接

### 插图一致性算法
1. **角色特征提取**: 从描述中提取关键视觉特征
2. **模板化描述**: 标准化角色和场景描述格式
3. **提示词增强**: 在每个提示词中重复关键特征
4. **风格统一**: 使用一致的艺术风格描述

### 性能优化
- **异步处理**: 并发生成多个页面的插图
- **缓存机制**: 缓存生成的内容和图像
- **错误恢复**: 智能的错误处理和重试机制

## 🐛 故障排除

### 常见问题

**1. API密钥错误**
```
解决方案: 检查config.py中的OPENAI_API_KEY设置
```

**2. 图像生成失败**
```
解决方案: 检查网络连接和API配额限制
```

**3. PDF导出错误**
```
解决方案: 确保exports目录有写入权限
```

**4. 依赖安装失败**
```
解决方案: 使用虚拟环境并更新pip版本
```

## 🚧 开发计划

- [ ] 支持多种绘画风格选择
- [ ] 添加故事模板库
- [ ] 实现用户账户系统
- [ ] 支持多语言生成
- [ ] 添加音频朗读功能
- [ ] 移动端适配优化


## 🤝 贡献指南

欢迎提交Issue和Pull Request来改进项目！

## 📞 联系方式

如有问题或建议，请通过以下方式联系：
- GitHub Issues
- Email: guanyu_ren@163.com

---

**TaleCanvas** - 让每个孩子都拥有属于自己的神奇故事书！ ✨
